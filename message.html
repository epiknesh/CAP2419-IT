<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Box Icons -->
  <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <!-- Bootstrap-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" 
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- CSS -->
  <link rel="stylesheet" href="styles/message.css">
  <!-- Title -->
  <title>Messages - JST Kidlat's BusMate</title>
</head>
<body>
  
  <!-- CONTENT -->
  <section id="content">
    <!-- MAIN -->
    <main>
      <div class="head-title d-flex justify-content-between">
      <a href="main_dashboard.html"><button type="button" class="btn btn-info" id="back_button">Back</button></a> 
          <div class="title text-center">
          <h1>JST Kidlat - Messages</h1>
        </div>
      </div>

      <!-- Chatbox -->
      <div class="chatbox card">
        <div class="card-body chatbox__messages">
          <div class="message message--received">
            <img src="img/noprofile.jpg" alt="Profile Picture" class="message__profile-pic">
            <div class="message__content">
              <p class="message__user">John Doe</p>
              <p>Hello! How can I help you today?</p>
              <span class="message__time">10:00 AM</span>
            </div>
          </div>
          <div class="message message--sent">
            <img src="img/noprofile.jpg" alt="Profile Picture" class="message__profile-pic">
            <div class="message__content">
              <p class="message__user">Jane Smith</p>
              <p>Hi! I need some information about the bus schedules.</p>
              <span class="message__time">10:01 AM</span>
            </div>
          </div>
          <!-- More messages as needed -->
        </div>
        <div class="card-footer chatbox__input d-flex">
          <input type="text" class="form-control me-2" placeholder="Type a message...">
          <button class="btn btn-primary"><i class='bx bx-send'></i></button>
        </div>
      </div>

    </main>
    <!-- End of MAIN -->
  </section>
  <!-- End of CONTENT -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    
    const socket = new WebSocket("ws://localhost:3000");

    // Scroll to bottom of chatbox
    const chatboxMessages = document.querySelector('.chatbox__messages');
    chatboxMessages.scrollTop = chatboxMessages.scrollHeight;

    // Function to add a new message to the chatbox
    function addMessage(user, message, isSent) {
      const newMessage = document.createElement('div');
      newMessage.className = isSent ? 'message message--sent' : 'message message--received';
      newMessage.innerHTML = `
        <img src="img/noprofile.jpg" alt="Profile Picture" class="message__profile-pic">
        <div class="message__content">
          <p class="message__user">${user}</p>
          <p>${message}</p>
          <span class="message__time">${new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })}</span>
        </div>
      `;
      chatboxMessages.appendChild(newMessage);
      chatboxMessages.scrollTop = chatboxMessages.scrollHeight;
    }

    // Receive messages from WebSocket
    socket.onmessage = (event) => {
      const receivedData = JSON.parse(event.data);
      addMessage(receivedData.user, receivedData.message, false);
    };

    // Send message on button click
    const sendButton = document.querySelector('.chatbox__input button');
    sendButton.addEventListener('click', () => {
      const input = document.querySelector('.chatbox__input input');
      const message = input.value.trim();
      if (message !== '') {
        const data = { user: 'Jane Smith', message };
        socket.send(JSON.stringify(data));
        addMessage(data.user, data.message, true);
        input.value = '';
      }
    });

    // Send message on Enter key press
    const input = document.querySelector('.chatbox__input input');
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendButton.click();
      }
    });


  </script>
</body>
</html>
